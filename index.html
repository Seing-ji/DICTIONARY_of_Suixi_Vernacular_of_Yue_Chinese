<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‚åŸç™½è©±å¤šåŠŸèƒ½éŸ³å…¸</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --background-color: #f5f7fa;
            --text-color: #333;
            --border-color: #ddd;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --audio-color: #4a6fa5;
            --vocab-color: #5d7a30;
            --definition-color: #a05252;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', 'Iansui', serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            padding: 12px;
            font-family: 'Iansui', 'Times New Roman', serif;
            font-size: 1em;
        }
        
        .dictionary-container {
            max-width: 960px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 24px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .mode-section {
            padding: 16px 24px 0;
            background: #f9fafc;
            border-bottom: 1px solid var(--border-color);
        }
        
        .mode-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .mode-tab {
            padding: 12px 20px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 1.02rem; /* å‡å°15% */
            transition: all 0.3s;
            font-weight: 500;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .mode-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .mode-tab.vocab-mode.active {
            background: var(--vocab-color);
            border-color: var(--vocab-color);
        }
        
        .mode-tab.definition-mode.active {
            background: var(--definition-color);
            border-color: var(--definition-color);
        }
        
        .search-section {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            background: #f9fafc;
        }
        
        .search-mode {
            display: flex;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .mode-btn {
            flex: 1;
            padding: 14px 16px;
            text-align: center;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 1.105rem; /* å‡å°15% */
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .mode-btn.vocab-active {
            background: var(--vocab-color);
            color: white;
        }
        
        .mode-btn.definition-active {
            background: var(--definition-color);
            color: white;
        }
        
        /* ä¿®æ­£æœç´¢æ¡†é€‚é…é—®é¢˜ */
        .search-box {
            display: flex;
            margin-bottom: 16px;
            width: 100%;
            max-width: 960px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #character-search-input,
        #vocab-search-input,
        #definition-search-input {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px 0 0 5px;
            font-size: 1.19rem; /* å‡å°15% */
            outline: none;
            transition: border-color 0.3s;
            min-width: 0;
            height: 52px;
            width: 100%;
        }
        
        #character-search-input:focus,
        #vocab-search-input:focus,
        #definition-search-input:focus {
            border-color: var(--primary-color);
        }
        
        .vocab-search #vocab-search-input:focus {
            border-color: var(--vocab-color);
        }
        
        .definition-search #definition-search-input:focus {
            border-color: var(--definition-color);
        }
        
        #character-search-button,
        #vocab-search-button,
        #definition-search-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0 32px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1.19rem; /* å‡å°15% */
            font-weight: 500;
            white-space: nowrap;
            height: 52px;
            flex-shrink: 0;
        }
        
        #character-search-button:hover {
            background: var(--secondary-color);
        }
        
        .vocab-search #vocab-search-button {
            background: var(--vocab-color);
        }
        
        .vocab-search #vocab-search-button:hover {
            background: #6b8c3c;
        }
        
        .definition-search #definition-search-button {
            background: var(--definition-color);
        }
        
        .definition-search #definition-search-button:hover {
            background: #b86c6c;
        }
        
        .search-options {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .exact-match-option {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.02rem; /* å‡å°15% */
        }
        
        .exact-match-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .category-filter {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.02rem; /* å‡å°15% */
            padding: 8px 0; /* å¢åŠ å†…è¾¹è·ä½¿å…¶æ›´å¤§ */
        }
        
        #category-select {
            padding: 25px 35px; /* æ˜¾è‘—å¢å¤§å†…è¾¹è· */
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 1.25rem; /* å¢å¤§å­—ä½“å¤§å° */
            min-width: 350px; /* å¢å¤§æœ€å°å®½åº¦ */
            background: white;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
            height: 54px; /* è®¾ç½®å›ºå®šé«˜åº¦ï¼Œä¸å…¶ä»–è¾“å…¥æ¡†å¯¹é½ */
        }
        
        #category-select:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        #category-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.3); /* æ›´æ˜æ˜¾çš„ç„¦ç‚¹æ•ˆæœ */
        }
        
        .search-info {
            font-size: 1.02rem; /* å‡å°15% */
            color: #666;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-icon {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.02rem; /* å‡å°15% */
        }
        
        .vocab-search .info-icon {
            color: var(--vocab-color);
        }
        
        .definition-search .info-icon {
            color: var(--definition-color);
        }
        
        .config-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .config-section h3 {
            margin-bottom: 12px;
            color: #856404;
            font-size: 1.4rem;
        }
        
        .data-status-container {
            margin-bottom: 16px;
            font-size: 1.1rem;
        }
        
        .phonology-link {
            margin: 12px 0;
            padding: 10px 14px;
            background: #e8f4f8;
            border-radius: 4px;
            border-left: 4px solid #4a6fa5;
            font-size: 1.05rem;
        }
        
        .phonology-link a {
            color: #2c5282;
            text-decoration: none;
            font-weight: bold;
        }
        
        .phonology-link a:hover {
            text-decoration: underline;
        }
        
        .character-note {
            margin: 12px 0;
            padding: 10px 14px;
            background: #f8f0e8;
            border-radius: 4px;
            border-left: 4px solid #a05252;
            font-size: 1.05rem;
            color: #5a3921;
        }
        
        /* éŸ³é‡æ§åˆ¶æ ·å¼ */
        .volume-control {
            margin-top: 12px;
            padding: 14px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        
        .volume-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .volume-header h4 {
            color: #495057;
            font-size: 1.1rem;
            margin: 0;
        }
        
        .volume-value {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1rem;
            min-width: 50px;
            text-align: right;
        }
        
        .volume-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-icon {
            color: var(--audio-color);
            font-size: 1.2rem;
            width: 28px;
            text-align: center;
        }
        
        .volume-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #dee2e6;
            border-radius: 4px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--audio-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .volume-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--audio-color);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .results-section {
            padding: 24px;
            min-height: 320px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .results-count {
            font-size: 1.3rem;
            color: #666;
        }
        
        .result-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .vocab-result .result-item {
            border-left-color: var(--vocab-color);
        }
        
        .definition-result .result-item {
            border-left-color: var(--definition-color);
        }
        
        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .character {
            font-size: 2.8rem;
            margin-bottom: 16px;
            font-weight: bold;
            text-align: center;
            color: var(--primary-color);
            line-height: 1.2;
            background-color: #fff9c4;
            padding: 6px 12px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .vocab-result .character {
            color: var(--vocab-color);
            background-color: #f0f8e8;
        }
        
        .definition-result .character {
            color: var(--definition-color);
            background-color: #f8e8e8;
        }
        
        .details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .detail-item {
            margin-bottom: 12px;
            font-size: 1.15rem; /* å‡å°å­—ä½“å¤§å°ï¼Œé˜²æ­¢æ¢è¡Œ */
            display: flex;
            align-items: center;
            flex-wrap: nowrap; /* ç¦æ­¢æ¢è¡Œ */
        }
        
        .label {
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 10px;
            display: inline-block;
            min-width: 70px;
            font-size: 1.15rem; /* å‡å°å­—ä½“å¤§å° */
            flex-shrink: 0;
            white-space: nowrap; /* ç¦æ­¢æ¢è¡Œ */
        }
        
        .vocab-result .label {
            color: var(--vocab-color);
        }
        
        .definition-result .label {
            color: var(--definition-color);
        }
        
        .bvz-value {
            font-family: 'Times New Roman', 'Iansui', serif !important;
            font-size: 1.3rem; /* å‡å°å­—ä½“å¤§å° */
            font-weight: bold;
            line-height: 1.3;
            white-space: nowrap; /* ç¦æ­¢æ¢è¡Œ */
        }
        
        .category-tag {
            display: inline-block;
            background: #e8f4f8;
            color: #2c5282;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.9rem; /* å‡å°å­—ä½“å¤§å° */
            margin-left: 12px;
            font-weight: normal;
            white-space: nowrap; /* ç¦æ­¢æ¢è¡Œ */
        }
        
        /* ä¾‹å¥æ ·å¼ */
        .example-container {
            margin-top: 16px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }
        
        .example-header {
            font-weight: bold;
            color: #495057;
            margin-bottom: 12px;
            font-size: 1.1rem; /* å‡å°å­—ä½“å¤§å° */
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .example-text {
            font-size: 1.1rem; /* å‡å°å­—ä½“å¤§å° */
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .example-bvz {
            font-family: 'Times New Roman', 'Iansui', serif !important;
            font-size: 1.15rem; /* å‡å°å­—ä½“å¤§å° */
            color: #4a6fa5;
            margin-bottom: 12px;
            font-weight: bold;
        }
        
        .example-translation {
            font-size: 1rem; /* å‡å°å­—ä½“å¤§å° */
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        /* ç®€æ´éŸ³é¢‘æŒ‰é’® */
        .audio-container {
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            margin-left: 12px;
            flex-shrink: 0;
        }
        
        .audio-play-btn {
            background: white;
            color: var(--audio-color);
            border: 1px solid var(--audio-color);
            width: 35px;
            height: 35px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0;
            transition: all 0.2s;
            padding: 0;
            margin: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='%234a6fa5'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 14px 14px;
            flex-shrink: 0;
        }
        
        .audio-play-btn:hover {
            background-color: var(--audio-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E");
        }
        
        .audio-play-btn.playing {
            background-color: var(--audio-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M6 19h4V5H6v14zm8-14v14h4V5h-4z'/%3E%3C/svg%3E");
        }
        
        .audio-play-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='%234a6fa5' opacity='0.5'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E");
        }
        
        .example-audio-btn {
            width: 32px;
            height: 32px;
            background-size: 12px 12px;
        }
        
        .no-results {
            text-align: center;
            padding: 48px 16px;
            color: #666;
        }
        
        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .loading {
            text-align: center;
            padding: 48px 16px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        .vocab-loading .spinner {
            border-top-color: var(--vocab-color);
        }
        
        .definition-loading .spinner {
            border-top-color: var(--definition-color);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #f8d7da;
            color: #dc3545;
            padding: 16px;
            border-radius: 5px;
            margin: 16px 0;
            border-left: 4px solid #dc3545;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: #666;
            border-top: 1px solid var(--border-color);
            background: #f9fafc;
        }
        
        /* ==================== ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ– ==================== */
        
        @media (max-width: 768px) {
            body {
                padding: 8px;
                font-size: 1em;
            }
            
            .dictionary-container {
                border-radius: 8px;
                max-width: 100%;
            }
            
            header {
                padding: 16px 12px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .description {
                font-size: 0.9rem;
                max-width: 100%;
            }
            
            .mode-section {
                padding: 12px 12px 0;
            }
            
            .mode-tab {
                padding: 10px 12px;
                font-size: 0.87rem; /* å‡å°15% */
                min-width: 110px;
            }
            
            .search-section {
                padding: 16px 12px;
            }
            
            .search-box {
                flex-direction: column;
                gap: 8px;
                max-width: 100%;
            }
            
            #character-search-input,
            #vocab-search-input,
            #definition-search-input {
                border-radius: 5px;
                font-size: 1.07rem; /* å‡å°15% */
                padding: 12px 15px;
                width: 100%;
                height: auto;
            }
            
            #character-search-button,
            #vocab-search-button,
            #definition-search-button {
                border-radius: 5px;
                padding: 12px 15px;
                font-size: 1.07rem; /* å‡å°15% */
                width: 100%;
                height: auto;
            }
            
            .search-mode {
                flex-direction: column;
            }
            
            .mode-btn {
                padding: 10px 12px;
                font-size: 0.995rem; /* å‡å°15% */
            }
            
            .search-options {
                flex-wrap: wrap;
                gap: 12px;
            }
            
            /* ç§»åŠ¨ç«¯åˆ†ç±»ç­›é€‰å¢å¤§ */
            .category-filter {
                gap: 8px;
                font-size: 0.87rem; /* å‡å°15% */
                width: 100%;
            }
            
            #category-select {
                min-width: 250px; /* ä¿æŒè¾ƒå¤§çš„æœ€å°å®½åº¦ */
                font-size: 1.15rem; /* ä¿æŒè¾ƒå¤§å­—ä½“ */
                padding: 14px 18px; /* ä¿æŒè¾ƒå¤§çš„å†…è¾¹è· */
                width: 100%;
                height: 50px; /* ç§»åŠ¨ç«¯é€‚å½“é«˜åº¦ */
            }
            
            .search-info {
                font-size: 0.87rem; /* å‡å°15% */
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .config-section {
                padding: 12px;
            }
            
            .config-section h3 {
                font-size: 1.1rem;
            }
            
            .results-section {
                padding: 16px 12px;
                min-height: 280px;
            }
            
            .results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .results-count {
                font-size: 1rem;
            }
            
            .result-item {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .character {
                font-size: 2rem;
                padding: 5px 8px;
                margin-bottom: 12px;
            }
            
            .details {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .detail-item {
                font-size: 1.1rem;
                flex-wrap: wrap;
            }
            
            .label {
                font-size: 1.1rem;
                min-width: 50px;
                margin-bottom: 4px;
            }
            
            .bvz-value {
                font-size: 1.2rem;
            }
            
            .category-tag {
                margin-left: 5px;
                font-size: 0.8rem;
                padding: 3px 6px;
            }
            
            .example-container {
                padding: 12px;
            }
            
            .example-header {
                font-size: 1rem;
            }
            
            .example-text {
                font-size: 1rem;
            }
            
            .example-bvz {
                font-size: 1.1rem;
            }
            
            .example-translation {
                font-size: 0.9rem;
            }
            
            .volume-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .volume-value {
                text-align: left;
            }
            
            footer {
                padding: 15px;
                font-size: 1rem;
            }
            
            .audio-play-btn {
                width: 28px;
                height: 28px;
            }
        }
        
        /* è¶…å°å±å¹•é€‚é…ï¼ˆå®½åº¦å°äº480pxï¼‰ */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.4rem;
            }
            
            .description {
                font-size: 0.85rem;
            }
            
            .mode-tab {
                padding: 8px 10px;
                font-size: 0.77rem; /* å‡å°15% */
                min-width: 90px;
            }
            
            #character-search-input,
            #vocab-search-input,
            #definition-search-input,
            #character-search-button,
            #vocab-search-button,
            #definition-search-button {
                font-size: 0.95rem; /* å‡å°15% */
                padding: 10px 12px;
            }
            
            .mode-btn {
                font-size: 0.89rem; /* å‡å°15% */
                padding: 8px 10px;
            }
            
            .character {
                font-size: 1.8rem;
            }
            
            .detail-item {
                font-size: 1rem;
            }
            
            .label {
                font-size: 1rem;
                min-width: 45px;
            }
            
            .bvz-value {
                font-size: 1.1rem;
            }
            
            /* è¶…å°å±å¹•çš„åˆ†ç±»ç­›é€‰ */
            .category-filter {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            #category-select {
                min-width: 100%;
                font-size: 1.05rem; /* ä¿æŒè¾ƒå¤§å­—ä½“ */
                padding: 12px 14px; /* ä¿æŒè¾ƒå¤§çš„å†…è¾¹è· */
                height: 48px;
            }
            
            .audio-play-btn {
                width: 26px;
                height: 26px;
                margin-left: 8px;
            }
        }
        
        /* ä¸­ç­‰å±å¹•ï¼ˆå¹³æ¿ï¼‰é€‚é… */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dictionary-container {
                max-width: 90%;
            }
        }
        
        /* å¤§å±å¹•é€‚é…ï¼ˆæ¡Œé¢ï¼‰ */
        @media (min-width: 1025px) {
            .search-box {
                max-width: 960px;
            }
            
            #character-search-input,
            #vocab-search-input,
            #definition-search-input {
                font-size: 1.275rem; /* å‡å°15% */
                padding: 18px 24px;
                height: 56px;
            }
            
            #character-search-button,
            #vocab-search-button,
            #definition-search-button {
                padding: 0 40px;
                font-size: 1.275rem; /* å‡å°15% */
                height: 56px;
            }
        }
    </style>
</head>
<body>
    <!-- HTMLå†…å®¹ä¿æŒä¸å˜ -->
    <div class="dictionary-container">
        <header>
            <h1>é‚åŸç™½è©±å¤šåŠŸèƒ½éŸ³å…¸</h1>
            <p class="description">æ”¯æŒæ¼¢å­—å’Œç™½è©±å­—ï¼ˆBVZï¼‰äº’æŸ¥ã€BVZ/è©æ¢æŸ¥è©¢é‡‹ç¾©ã€é‡‹ç¾©åæŸ¥åŠŸèƒ½</p>
        </header>
        
        <section class="mode-section">
            <div class="mode-selector">
                <div class="mode-tab active" data-mode="character">æ¼¢å­—èˆ‡BVZäº’æŸ¥</div>
                <div class="mode-tab vocab-mode" data-mode="vocab">BVZ/è©æ¢æŸ¥é‡‹ç¾©</div>
                <div class="mode-tab definition-mode" data-mode="definition">é‡‹ç¾©åæŸ¥</div>
            </div>
        </section>
        
        <!-- æ¼¢å­—èˆ‡BVZäº’æŸ¥æ¨¡å¼ -->
        <section class="search-section character-search" id="character-search-section">
            <div class="search-mode">
                <button class="mode-btn active" data-mode="character">æ¼¢å­—æŸ¥BVZ</button>
                <button class="mode-btn" data-mode="bvz">BVZåæŸ¥æ¼¢å­—</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="character-search-input" placeholder="è«‹è¼¸å…¥è¦æŸ¥è©¢çš„æ¼¢å­—...">
                <button id="character-search-button">æœç´¢</button>
            </div>
            
            <div class="search-options">
                <div class="exact-match-option">
                    <input type="checkbox" id="character-exact-match" class="exact-match-checkbox">
                    <label for="character-exact-match">ç²¾ç¢ºåŒ¹é…</label>
                </div>
            </div>
            
            <p class="search-info">
                <span class="info-icon">â„¹ï¸</span>
                <span id="character-search-hint">è¼¸å…¥æ¼¢å­—æŸ¥è©¢å°æ‡‰çš„BVZè®€éŸ³å’Œæ³¨é‡‹ï¼ˆæ”¯æŒå¤šå­—æŸ¥è©¢ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼‰</span>
                <div class="phonology-link">
                <strong>éŸ³ç³»ç‰¹å¾µèªªæ˜:</strong> 
                <a href="https://github.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/blob/main/README.md" target="_blank">æŸ¥çœ‹é‚åŸç™½è©±éŸ³ç³»ç‰¹å¾µèªªæ˜</a></div>
                <div class="character-note">
                <strong>æ³¨æ„:</strong> è©å½™éƒ¨åˆ†æ‰€é¸æ¼¢å­—å‡éæ­£å­—æˆ–æœ¬å­—ï¼Œé‡è¦çš„æ˜¯ç™¼éŸ³å’Œé‡‹ç¾©ã€‚</div>
            </p>
        </section>
        
        <!-- BVZ/è©æ¢æŸ¥é‡‹ç¾©æ¨¡å¼ -->
        <section class="search-section vocab-search" id="vocab-search-section" style="display:none;">
            <div class="search-mode">
                <button class="mode-btn vocab-active" data-mode="vocab-bvz">BVZæŸ¥é‡‹ç¾©</button>
                <button class="mode-btn" data-mode="vocab-word">è©æ¢æŸ¥é‡‹ç¾©</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="vocab-search-input" placeholder="è«‹è¼¸å…¥BVZæˆ–è©æ¢...">
                <button id="vocab-search-button">æœç´¢</button>
            </div>
            
            <div class="search-options">
                <div class="exact-match-option">
                    <input type="checkbox" id="vocab-exact-match" class="exact-match-checkbox">
                    <label for="vocab-exact-match">ç²¾ç¢ºåŒ¹é…</label>
                </div>
                <div class="category-filter">
                    <label for="vocab-category-select">åˆ†é¡ç¯©é¸:</label>
                    <select id="vocab-category-select">
                        <option value="all">å…¨éƒ¨é¡åˆ¥</option>
                    </select>
                </div>
            </div>
            
            <p class="search-info">
                <span class="info-icon">â„¹ï¸</span>
                <span id="vocab-search-hint">è¼¸å…¥BVZæˆ–è©æ¢æŸ¥è©¢å°æ‡‰çš„é‡‹ç¾©ï¼ˆæ”¯æŒå¤šå€‹æŸ¥è©¢ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼‰</span>
                <div class="phonology-link">
                <strong>éŸ³ç³»ç‰¹å¾µèªªæ˜:</strong> 
                <a href="https://github.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/blob/main/README.md" target="_blank">æŸ¥çœ‹é‚åŸç™½è©±éŸ³ç³»ç‰¹å¾µèªªæ˜</a></div>
                <div class="character-note">
                <strong>æ³¨æ„:</strong> è©å½™éƒ¨åˆ†æ‰€é¸æ¼¢å­—å‡éæ­£å­—æˆ–æœ¬å­—ï¼Œé‡è¦çš„æ˜¯ç™¼éŸ³å’Œé‡‹ç¾©ã€‚</div>
            </p>
        </section>
        
        <!-- é‡‹ç¾©åæŸ¥æ¨¡å¼ -->
        <section class="search-section definition-search" id="definition-search-section" style="display:none;">
            <div class="search-mode">
                <button class="mode-btn definition-active" data-mode="definition">é‡‹ç¾©åæŸ¥</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="definition-search-input" placeholder="è«‹è¼¸å…¥è¦æŸ¥è©¢çš„é‡‹ç¾©é—œéµè©...">
                <button id="definition-search-button">æœç´¢</button>
            </div>
            
            <div class="search-options">
                <div class="exact-match-option">
                    <input type="checkbox" id="definition-exact-match" class="exact-match-checkbox">
                    <label for="definition-exact-match">ç²¾ç¢ºåŒ¹é…</label>
                </div>
                <div class="category-filter">
                    <label for="definition-category-select">åˆ†é¡ç¯©é¸:</label>
                    <select id="definition-category-select">
                        <option value="all">å…¨éƒ¨é¡åˆ¥</option>
                    </select>
                </div>
            </div>
            
            <p class="search-info">
                <span class="info-icon">â„¹ï¸</span>
                <span id="definition-search-hint">è¼¸å…¥é‡‹ç¾©é—œéµè©åæŸ¥å°æ‡‰çš„è©æ¢å’ŒBVZï¼ˆæ”¯æŒå¤šå€‹é—œéµè©ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼‰</span>
                <div class="phonology-link">
                <strong>éŸ³ç³»ç‰¹å¾µèªªæ˜:</strong> 
                <a href="https://github.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/blob/main/README.md" target="_blank">æŸ¥çœ‹é‚åŸç™½è©±éŸ³ç³»ç‰¹å¾µèªªæ˜</a></div>
                <div class="character-note">
                <strong>æ³¨æ„:</strong> è©å½™éƒ¨åˆ†æ‰€é¸æ¼¢å­—å‡éæ­£å­—æˆ–æœ¬å­—ï¼Œé‡è¦çš„æ˜¯ç™¼éŸ³å’Œé‡‹ç¾©ã€‚</div>
            </p>
        </section>
        
        <div class="config-section">
            <h3>æ•¸æ“šç‹€æ…‹</h3>
            <div class="data-status-container" id="data-status">æ­£åœ¨åˆå§‹åŒ–...</div>
            
            
            
            <!-- éŸ³é‡æ§åˆ¶ -->
            <div class="volume-control">
                <div class="volume-header">
                    <h4>éŸ³é‡æ§åˆ¶</h4>
                    <div class="volume-value" id="volume-value">70%</div>
                </div>
                <div class="volume-slider-container">
                    <div class="volume-icon">ğŸ”ˆ</div>
                    <input type="range" min="0" max="100" value="70" class="volume-slider" id="volume-slider">
                    <div class="volume-icon">ğŸ”Š</div>
                </div>
            </div>
        </div>
        
        <section class="results-section" id="results-container">
            <div class="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨åŠ è¼‰å­—å…¸æ•¸æ“š...</p>
            </div>
        </section>
        
        <footer>
            <p>æ–¹è¨€å­—å…¸æ•¸æ“šç”±GitHubæä¾›æ”¯æŒ | è¨­è¨ˆï¼šSá»ng-jÄ© NgÃ ng</p>
        </footer>
    </div>

    <!-- JavaScriptä»£ç ä¿æŒä¸å˜ -->
    <script>
        // é…ç½® - ä¸¥æ ¼æŒ‰ç…§åŸæ–¹æ¡ˆ
        const CONFIG = {
            // æ•°æ®æºURL
            DICTIONARY_JSON_URL: 'https://raw.githubusercontent.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/main/DICTIONARY.json',
            VOCABULARY_JSON_URL: 'https://raw.githubusercontent.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/main/VOCABULARY.json',
            
            // é€šç”¨é…ç½®
            MAX_RESULTS: 1000,
            AUDIO_CACHE: new Map(),
            PRELOAD_IMMEDIATE: 3,
            PRELOAD_PRIORITY: 10,
            PRELOAD_BACKGROUND: 20,
            DEFAULT_VOLUME: 0.7,
            MIN_VOLUME: 0.0,
            MAX_VOLUME: 1.0,
            
            // åˆ†éš”ç¬¦é…ç½®
            SEPARATOR: /[,ï¼Œ\s]+/,
            SPACE_SEPARATOR: /\s+/
        };
        
        // å…¨å±€å˜é‡
        let dictionaryData = [];
        let vocabularyData = [];
        let currentMainMode = 'character';
        let currentSubMode = 'character';
        let exactMatch = false;
        let searchTimeout = null;
        let currentAudio = null;
        let currentPlayingButton = null;
        let currentResults = [];
        let audioPreloadController = null;
        let currentVolume = CONFIG.DEFAULT_VOLUME;
        let categoryOptions = new Set();
        
        // DOMå…ƒç´ 
        const modeTabs = document.querySelectorAll('.mode-tab');
        const searchSections = {
            character: document.getElementById('character-search-section'),
            vocab: document.getElementById('vocab-search-section'),
            definition: document.getElementById('definition-search-section')
        };
        
        const searchInputs = {
            character: document.getElementById('character-search-input'),
            vocab: document.getElementById('vocab-search-input'),
            definition: document.getElementById('definition-search-input')
        };
        
        const searchButtons = {
            character: document.getElementById('character-search-button'),
            vocab: document.getElementById('vocab-search-button'),
            definition: document.getElementById('definition-search-button')
        };
        
        const modeButtons = {
            character: document.querySelectorAll('#character-search-section .mode-btn'),
            vocab: document.querySelectorAll('#vocab-search-section .mode-btn'),
            definition: document.querySelectorAll('#definition-search-section .mode-btn')
        };
        
        const searchHints = {
            character: document.getElementById('character-search-hint'),
            vocab: document.getElementById('vocab-search-hint'),
            definition: document.getElementById('definition-search-hint')
        };
        
        const exactMatchCheckboxes = {
            character: document.getElementById('character-exact-match'),
            vocab: document.getElementById('vocab-exact-match'),
            definition: document.getElementById('definition-exact-match')
        };
        
        const categorySelects = {
            vocab: document.getElementById('vocab-category-select'),
            definition: document.getElementById('definition-category-select')
        };
        
        const resultsContainer = document.getElementById('results-container');
        const dataStatus = document.getElementById('data-status');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeValue = document.getElementById('volume-value');
        
        // åˆå§‹åŒ–
        async function init() {
            dataStatus.textContent = 'æ­£åœ¨åˆå§‹åŒ–...';
            
            try {
                await loadAllData();
                setupEventListeners();
                updateSearchHint();
                
                // åŠ è½½éŸ³é‡è®¾ç½®
                if (!loadVolumeFromStorage()) {
                    setVolume(CONFIG.DEFAULT_VOLUME);
                }
                updateVolumeDisplay();
                
                searchInputs.character.focus();
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
                showError(`åŠ è¼‰æ•¸æ“šå¤±æ•—: ${error.message}`);
            }
        }
        
        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllData() {
            showLoading();
            dataStatus.textContent = 'æ­£åœ¨å¾GitHubåŠ è¼‰å­—å…¸æ•¸æ“š...';
            
            try {
                // åŠ è½½å­—å…¸æ•°æ®
                const dictResponse = await fetch(CONFIG.DICTIONARY_JSON_URL);
                if (!dictResponse.ok) {
                    throw new Error(`å­—å…¸æ•¸æ“šHTTPéŒ¯èª¤! ç‹€æ…‹: ${dictResponse.status}`);
                }
                
                const dictText = await dictResponse.text();
                const dictData = JSON.parse(dictText);
                dictionaryData = processDictionaryData(dictData);
                
                // åŠ è½½è¯æ±‡æ•°æ®
                dataStatus.textContent = 'æ­£åœ¨å¾GitHubåŠ è¼‰è©å½™æ•¸æ“š...';
                const vocabResponse = await fetch(CONFIG.VOCABULARY_JSON_URL);
                if (!vocabResponse.ok) {
                    throw new Error(`è©å½™æ•¸æ“šHTTPéŒ¯èª¤! ç‹€æ…‹: ${vocabResponse.status}`);
                }
                
                const vocabText = await vocabResponse.text();
                const vocabData = JSON.parse(vocabText);
                
                // è°ƒè¯•ï¼šæŸ¥çœ‹VOCABULARY.jsonçš„ç»“æ„
                console.log('VOCABULARY.json æ•°æ®ç»“æ„:', vocabData);
                
                if (Array.isArray(vocabData) && vocabData.length > 0) {
                    console.log('ç¬¬ä¸€æ¡è¯æ±‡æ•°æ®:', vocabData[0]);
                }
                
                vocabularyData = processVocabularyData(vocabData);
                
                // è°ƒè¯•ï¼šæŸ¥çœ‹å¤„ç†åçš„è¯æ±‡æ•°æ®
                console.log('å¤„ç†åçš„è¯æ±‡æ•°æ®:', vocabularyData);
                if (vocabularyData.length > 0) {
                    console.log('ç¬¬ä¸€æ¡å¤„ç†åçš„è¯æ±‡æ•°æ®:', vocabularyData[0]);
                }
                
                // æå–åˆ†ç±»é€‰é¡¹
                extractCategories();
                
                const dictItemsWithAudio = dictionaryData.filter(item => item.audioUrl).length;
                const vocabItemsWithAudio = vocabularyData.filter(item => item.audioUrl).length;
                const vocabItemsWithExample = vocabularyData.filter(item => item.ä¾‹å¥ && item.ä¾‹å¥.trim()).length;
                const vocabItemsWithExampleAudio = vocabularyData.filter(item => item.ä¾‹å¥éŸ³é » && item.ä¾‹å¥éŸ³é ».trim()).length;
                
                dataStatus.textContent = `æ•¸æ“šåŠ è¼‰æˆåŠŸ! å­—å…¸: ${dictionaryData.length} æ¢, è©å½™: ${vocabularyData.length} æ¢`;
                if (dictItemsWithAudio + vocabItemsWithAudio > 0) {
                    dataStatus.textContent += ` | éŸ³é »: ${dictItemsWithAudio + vocabItemsWithAudio} æ¢`;
                }
                if (vocabItemsWithExample > 0) {
                    dataStatus.textContent += ` | ä¾‹å¥: ${vocabItemsWithExample} æ¢`;
                }
                if (vocabItemsWithExampleAudio > 0) {
                    dataStatus.textContent += ` | ä¾‹å¥éŸ³é »: ${vocabItemsWithExampleAudio} æ¢`;
                }
                if (categoryOptions.size > 0) {
                    dataStatus.textContent += ` | åˆ†é¡: ${categoryOptions.size} å€‹`;
                }
                
                showMessage('æ•¸æ“šåŠ è¼‰æˆåŠŸ! è«‹é¸æ“‡æŸ¥è©¢æ¨¡å¼ä¸¦è¼¸å…¥å…§å®¹é€²è¡ŒæŸ¥è©¢');
                
            } catch (error) {
                console.error('åŠ è¼‰æ•¸æ“šå¤±æ•—:', error);
                dataStatus.textContent = `æ•¸æ“šåŠ è¼‰å¤±æ•—: ${error.message}`;
                throw error;
            }
        }
        
        // å¤„ç†å­—å…¸æ•°æ®æ ¼å¼ - ä¸¥æ ¼æŒ‰ç…§åŸæ–¹æ¡ˆ
        function processDictionaryData(data) {
            if (!data || typeof data !== 'object') {
                throw new Error('å­—å…¸æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º');
            }
            
            let dataArray = Array.isArray(data) ? data : Object.values(data);
            
            return dataArray
                .filter(item => item && (item.å–®å­— || item.BVZ))
                .map(item => {
                    let audioUrl = item.audio || '';
                    if (audioUrl && audioUrl.includes('github.com')) {
                        audioUrl = audioUrl
                            .replace('https://raw.githubusercontent.com/', 'https://cdn.jsdelivr.net/gh/')
                            .replace('/main/', '/');
                    }
                    
                    return {
                        å–®å­—: item.å–®å­— || '',
                        BVZ: item.BVZ || '',
                        Note: item.Note || item.note || '',
                        audioUrl: audioUrl,
                        type: 'dictionary'
                    };
                });
        }
        
        // å¤„ç†è¯æ±‡æ•°æ®æ ¼å¼ - ä¿®å¤å­—æ®µæ˜ å°„
        function processVocabularyData(data) {
            if (!data || typeof data !== 'object') {
                throw new Error('è©å½™æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º');
            }
            
            let dataArray = Array.isArray(data) ? data : Object.values(data);
            
            const processedData = dataArray
                .filter(item => item && (item.BVZ || item.è©æ¢ || item.é‡‹ç¾©))
                .map(item => {
                    console.log('åŸå§‹è¯æ±‡æ•°æ®:', item);
                    
                    // å¤„ç†è¯æ¡ - ç¡®ä¿æœ‰è¯æ¡å­—æ®µ
                    let è©æ¢ = item.è©æ¢ || item.word || item.è¯æ¡ || '';
                    let BVZ = item.BVZ || item.bvz || '';
                    let é‡‹ç¾© = item.é‡‹ç¾© || item.é‡Šä¹‰ || item.definition || '';
                    let è©æ¢é¡åˆ¥ = item.è©æ¢é¡åˆ¥ || item.category || item.åˆ†ç±» || '';
                    
                    // å¤„ç†éŸ³é¢‘
                    let audioUrl = item.vocabularyAudio || item.éŸ³é » || item.audio || '';
                    if (audioUrl && audioUrl.includes('github.com')) {
                        audioUrl = audioUrl
                            .replace('https://raw.githubusercontent.com/', 'https://cdn.jsdelivr.net/gh/')
                            .replace('/main/', '/');
                    }
                    
                    // å¤„ç†ä¾‹å¥
                    let ä¾‹å¥ = '';
                    let ä¾‹å¥BVZ = '';
                    let ä¾‹å¥éŸ³é » = '';
                    let ä¾‹å¥ç¿»è­¯ = '';
                    
                    // å¤„ç†examplesæ•°ç»„
                    if (item.examples && Array.isArray(item.examples) && item.examples.length > 0) {
                        const example = item.examples[0];
                        ä¾‹å¥ = example.ä¾‹å¥ || example.sentence || '';
                        ä¾‹å¥BVZ = example.ä¾‹å¥çš„BVZè½‰å¯« || example.bvzTranscription || example.ä¾‹å¥BVZ || '';
                        ä¾‹å¥éŸ³é » = example.exampleAudio || example.audio || '';
                        ä¾‹å¥ç¿»è­¯ = example.translation || '';
                        
                        // å¤„ç†ä¾‹å¥éŸ³é¢‘
                        if (ä¾‹å¥éŸ³é » && ä¾‹å¥éŸ³é ».includes('github.com')) {
                            ä¾‹å¥éŸ³é » = ä¾‹å¥éŸ³é »
                                .replace('https://raw.githubusercontent.com/', 'https://cdn.jsdelivr.net/gh/')
                                .replace('/main/', '/');
                        }
                    }
                    
                    const processedItem = {
                        BVZ: BVZ,
                        è©æ¢: è©æ¢,
                        é‡‹ç¾©: é‡‹ç¾©,
                        é¡åˆ¥: è©æ¢é¡åˆ¥,
                        audioUrl: audioUrl,
                        ä¾‹å¥: ä¾‹å¥,
                        ä¾‹å¥BVZ: ä¾‹å¥BVZ,
                        ä¾‹å¥éŸ³é »: ä¾‹å¥éŸ³é »,
                        ä¾‹å¥ç¿»è­¯: ä¾‹å¥ç¿»è­¯,
                        type: 'vocabulary'
                    };
                    
                    console.log('å¤„ç†åçš„è¯æ±‡é¡¹:', processedItem);
                    return processedItem;
                });
            
            console.log('æ€»å…±å¤„ç†è¯æ±‡æ•°æ®:', processedData.length, 'æ¡');
            return processedData;
        }
        
        // æå–åˆ†ç±»é€‰é¡¹
        function extractCategories() {
            categoryOptions.clear();
            
            // ä»è¯æ±‡æ•°æ®æå–åˆ†ç±»
            vocabularyData.forEach(item => {
                if (item.é¡åˆ¥ && item.é¡åˆ¥.trim()) {
                    categoryOptions.add(item.é¡åˆ¥.trim());
                }
            });
            
            console.log('æå–åˆ°çš„åˆ†ç±»:', Array.from(categoryOptions));
            
            // æ›´æ–°åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
            updateCategorySelects();
        }
        
        // æ›´æ–°åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateCategorySelects() {
            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨ç±»åˆ¥"ï¼‰
            categorySelects.vocab.innerHTML = '<option value="all">å…¨éƒ¨é¡åˆ¥</option>';
            categorySelects.definition.innerHTML = '<option value="all">å…¨éƒ¨é¡åˆ¥</option>';
            
            // æ·»åŠ åˆ†ç±»é€‰é¡¹
            const sortedCategories = Array.from(categoryOptions).sort();
            console.log('æ’åºåçš„åˆ†ç±»:', sortedCategories);
            
            sortedCategories.forEach(category => {
                const option1 = document.createElement('option');
                option1.value = category;
                option1.textContent = category;
                categorySelects.vocab.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = category;
                option2.textContent = category;
                categorySelects.definition.appendChild(option2);
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ä¸»æ¨¡å¼åˆ‡æ¢
            modeTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    modeTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentMainMode = this.dataset.mode;
                    
                    // éšè—æ‰€æœ‰æœç´¢åŒºåŸŸï¼Œæ˜¾ç¤ºå½“å‰æ¨¡å¼çš„æœç´¢åŒºåŸŸ
                    Object.values(searchSections).forEach(section => {
                        section.style.display = 'none';
                    });
                    searchSections[currentMainMode].style.display = 'block';
                    
                    // æ›´æ–°ç»“æœå®¹å™¨ç±»å
                    updateResultsContainerClass();
                    
                    // é‡ç½®å­æ¨¡å¼
                    resetSubMode();
                    
                    // æ›´æ–°æœç´¢æç¤º
                    updateSearchHint();
                    
                    // è·å–å½“å‰æ¨¡å¼çš„ç²¾ç¡®åŒ¹é…å¤é€‰æ¡†çŠ¶æ€
                    exactMatch = exactMatchCheckboxes[currentMainMode].checked;
                    
                    showMessage('è«‹è¼¸å…¥å…§å®¹é€²è¡ŒæŸ¥è©¢');
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†å¹¶èšç„¦
                    clearSearchInputs();
                    searchInputs[currentMainMode].focus();
                });
            });
            
            // å­æ¨¡å¼åˆ‡æ¢
            Object.keys(modeButtons).forEach(mode => {
                modeButtons[mode].forEach(button => {
                    button.addEventListener('click', function() {
                        modeButtons[mode].forEach(btn => {
                            btn.classList.remove('active');
                            btn.classList.remove('vocab-active');
                            btn.classList.remove('definition-active');
                        });
                        
                        this.classList.add('active');
                        
                        if (mode === 'vocab') {
                            this.classList.add('vocab-active');
                        } else if (mode === 'definition') {
                            this.classList.add('definition-active');
                        }
                        
                        currentSubMode = this.dataset.mode;
                        updateSearchHint();
                        
                        const query = searchInputs[currentMainMode].value.trim();
                        if (query) performSearch(query);
                    });
                });
            });
            
            // ç²¾ç¡®åŒ¹é…å¤é€‰æ¡†
            Object.keys(exactMatchCheckboxes).forEach(mode => {
                exactMatchCheckboxes[mode].addEventListener('change', function() {
                    exactMatch = this.checked;
                    updateSearchHint();
                    const query = searchInputs[currentMainMode].value.trim();
                    if (query) performSearch(query);
                });
            });
            
            // æœç´¢è¾“å…¥äº‹ä»¶
            Object.keys(searchInputs).forEach(mode => {
                searchInputs[mode].addEventListener('input', function() {
                    if (searchTimeout) clearTimeout(searchTimeout);
                    
                    const query = this.value.trim();
                    if (!query) {
                        showMessage('è«‹è¼¸å…¥å…§å®¹é€²è¡ŒæŸ¥è©¢');
                        return;
                    }
                    
                    searchTimeout = setTimeout(() => performSearch(query), 300);
                });
                
                searchInputs[mode].addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const query = searchInputs[mode].value.trim();
                        if (query) performSearch(query);
                    }
                });
            });
            
            // æœç´¢æŒ‰é’®äº‹ä»¶
            Object.keys(searchButtons).forEach(mode => {
                searchButtons[mode].addEventListener('click', () => {
                    const query = searchInputs[mode].value.trim();
                    if (query) performSearch(query);
                });
            });
            
            // åˆ†ç±»ç­›é€‰äº‹ä»¶
            Object.keys(categorySelects).forEach(mode => {
                categorySelects[mode].addEventListener('change', function() {
                    const query = searchInputs[currentMainMode].value.trim();
                    if (query) performSearch(query);
                });
            });
            
            // éŸ³é‡æ§åˆ¶
            volumeSlider.addEventListener('input', handleVolumeChange);
            volumeSlider.addEventListener('change', handleVolumeChange);
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆå¤„ç†éŸ³é‡å˜åŒ–
        function handleVolumeChange() {
            const sliderValue = parseInt(volumeSlider.value);
            const volume = sliderValue / 100;
            
            setVolume(volume);
            updateVolumeDisplay();
            
            if (currentAudio) {
                currentAudio.volume = currentVolume;
            }
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆè®¾ç½®éŸ³é‡
        function setVolume(volume) {
            currentVolume = Math.max(CONFIG.MIN_VOLUME, Math.min(CONFIG.MAX_VOLUME, volume));
            
            try {
                localStorage.setItem('dictionary_volume', currentVolume.toString());
            } catch (e) {
                console.log('æ— æ³•ä¿å­˜éŸ³é‡è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨');
            }
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆæ›´æ–°éŸ³é‡æ˜¾ç¤º
        function updateVolumeDisplay() {
            const percentage = Math.round(currentVolume * 100);
            volumeValue.textContent = `${percentage}%`;
            volumeSlider.value = percentage;
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆä»localStorageåŠ è½½éŸ³é‡è®¾ç½®
        function loadVolumeFromStorage() {
            try {
                const savedVolume = localStorage.getItem('dictionary_volume');
                if (savedVolume !== null) {
                    const volume = parseFloat(savedVolume);
                    if (!isNaN(volume) && volume >= 0 && volume <= 1) {
                        setVolume(volume);
                        return true;
                    }
                }
            } catch (e) {
                console.log('æ— æ³•ä»æœ¬åœ°å­˜å‚¨åŠ è½½éŸ³é‡è®¾ç½®');
            }
            return false;
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆé”®ç›˜å¿«æ·é”®
        function handleKeyboardShortcuts(event) {
            if (document.activeElement === searchInputs[currentMainMode]) return;
            
            switch(event.key) {
                case '+':
                case '=':
                    event.preventDefault();
                    adjustVolume(0.1);
                    break;
                case '-':
                case '_':
                    event.preventDefault();
                    adjustVolume(-0.1);
                    break;
                case '0':
                    event.preventDefault();
                    toggleMute();
                    break;
            }
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆè°ƒæ•´éŸ³é‡
        function adjustVolume(delta) {
            let newVolume = currentVolume + delta;
            newVolume = Math.max(CONFIG.MIN_VOLUME, Math.min(CONFIG.MAX_VOLUME, newVolume));
            
            setVolume(newVolume);
            updateVolumeDisplay();
            
            if (currentAudio) {
                currentAudio.volume = currentVolume;
            }
        }
        
        // æŒ‰ç…§åŸæ–¹æ¡ˆåˆ‡æ¢é™éŸ³
        function toggleMute() {
            if (currentVolume > 0) {
                localStorage.setItem('dictionary_last_volume', currentVolume.toString());
                setVolume(0);
            } else {
                try {
                    const lastVolume = localStorage.getItem('dictionary_last_volume');
                    const volume = lastVolume ? parseFloat(lastVolume) : CONFIG.DEFAULT_VOLUME;
                    setVolume(volume);
                } catch (e) {
                    setVolume(CONFIG.DEFAULT_VOLUME);
                }
            }
            
            updateVolumeDisplay();
            
            if (currentAudio) {
                currentAudio.volume = currentVolume;
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰æœç´¢è¾“å…¥æ¡†
        function clearSearchInputs() {
            Object.values(searchInputs).forEach(input => {
                input.value = '';
            });
        }
        
        // é‡ç½®å­æ¨¡å¼
        function resetSubMode() {
            if (currentMainMode === 'character') {
                currentSubMode = 'character';
                modeButtons.character.forEach(btn => btn.classList.remove('active'));
                modeButtons.character[0].classList.add('active');
            } else if (currentMainMode === 'vocab') {
                currentSubMode = 'vocab-bvz';
                modeButtons.vocab.forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.remove('vocab-active');
                });
                modeButtons.vocab[0].classList.add('active');
                modeButtons.vocab[0].classList.add('vocab-active');
            } else if (currentMainMode === 'definition') {
                currentSubMode = 'definition';
                modeButtons.definition.forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.remove('definition-active');
                });
                modeButtons.definition[0].classList.add('active');
                modeButtons.definition[0].classList.add('definition-active');
            }
        }
        
        // æ›´æ–°ç»“æœå®¹å™¨ç±»å
        function updateResultsContainerClass() {
            resultsContainer.className = 'results-section';
            if (currentMainMode === 'vocab') {
                resultsContainer.classList.add('vocab-result');
            } else if (currentMainMode === 'definition') {
                resultsContainer.classList.add('definition-result');
            }
        }
        
        // æ›´æ–°æœç´¢æç¤º
        function updateSearchHint() {
            if (currentMainMode === 'character') {
                if (currentSubMode === 'character') {
                    searchInputs.character.placeholder = 'è«‹è¼¸å…¥è¦æŸ¥è©¢çš„æ¼¢å­—ï¼ˆå¤šå­—ç”¨é€—è™Ÿåˆ†éš”ï¼‰...';
                    if (exactMatch) {
                        searchHints.character.textContent = 'è¼¸å…¥æ¼¢å­—æŸ¥è©¢å°æ‡‰çš„ç™½è©±å­—(BVZ)å’Œæ³¨é‡‹ï¼ˆç²¾ç¢ºåŒ¹é…æ¨¡å¼ï¼‰';
                    } else {
                        searchHints.character.textContent = 'è¼¸å…¥æ¼¢å­—æŸ¥è©¢å°æ‡‰çš„ç™½è©±å­—ï¼ˆBVZï¼‰å’Œæ³¨é‡‹ï¼ˆæ”¯æŒå¤šå­—æŸ¥è©¢, ç”¨é€—è™Ÿåˆ†éš”ï¼‰';
                    }
                } else {
                    searchInputs.character.placeholder = 'è«‹è¼¸å…¥ç™½è©±å­—ï¼ˆBVZï¼‰ï¼ˆå¤šå€‹ç”¨é€—è™Ÿåˆ†éš”ï¼‰...';
                    if (exactMatch) {
                        searchHints.character.textContent = 'è¼¸å…¥ç™½è©±å­—ï¼ˆBVZï¼‰åæŸ¥å°æ‡‰çš„æ¼¢å­—å’Œæ³¨é‡‹ï¼ˆç²¾ç¢ºåŒ¹é…æ¨¡å¼ï¼‰';
                    } else {
                        searchHints.character.textContent = 'è¼¸å…¥ç™½è©±å­—ï¼ˆBVZï¼‰åæŸ¥å°æ‡‰çš„æ¼¢å­—å’Œæ³¨é‡‹ï¼ˆæ”¯æŒå¤šå€‹BVZæŸ¥è©¢, ç”¨é€—è™Ÿåˆ†éš”ï¼‰';
                    }
                }
            } else if (currentMainMode === 'vocab') {
                if (currentSubMode === 'vocab-bvz') {
                    searchInputs.vocab.placeholder = 'è«‹è¼¸å…¥ç™½è©±å­—ï¼ˆBVZï¼‰ï¼ˆå¤šå€‹ç”¨é€—è™Ÿåˆ†éš”ï¼‰...';
                    if (exactMatch) {
                        searchHints.vocab.textContent = 'è¼¸å…¥BVZæŸ¥è©¢å°æ‡‰çš„é‡‹ç¾©ï¼ˆç²¾ç¢ºåŒ¹é…æ¨¡å¼ï¼‰';
                    } else {
                        searchHints.vocab.textContent = 'è¼¸å…¥BVZæŸ¥è©¢å°æ‡‰çš„é‡‹ç¾©ï¼ˆæ¨¡ç³ŠåŒ¹é…æ¨¡å¼ï¼Œå¿½ç•¥é€£å­—ç¬¦ï¼‰';
                    }
                } else {
                    searchInputs.vocab.placeholder = 'è«‹è¼¸å…¥è©æ¢ï¼ˆå¤šå€‹ç”¨é€—è™Ÿåˆ†éš”ï¼‰...';
                    if (exactMatch) {
                        searchHints.vocab.textContent = 'è¼¸å…¥è©æ¢æŸ¥è©¢å°æ‡‰çš„é‡‹ç¾©ï¼ˆç²¾ç¢ºåŒ¹é…æ¨¡å¼ï¼‰';
                    } else {
                        searchHints.vocab.textContent = 'è¼¸å…¥è©æ¢æŸ¥è©¢å°æ‡‰çš„é‡‹ç¾©ï¼ˆæ”¯æŒå¤šå€‹è©æ¢æŸ¥è©¢, ç”¨é€—è™Ÿåˆ†éš”ï¼‰';
                    }
                }
            } else if (currentMainMode === 'definition') {
                searchInputs.definition.placeholder = 'è«‹è¼¸å…¥é‡‹ç¾©é—œéµè©ï¼ˆå¤šå€‹ç”¨é€—è™Ÿåˆ†éš”ï¼‰...';
                if (exactMatch) {
                    searchHints.definition.textContent = 'è¼¸å…¥é‡‹ç¾©é—œéµè©åæŸ¥å°æ‡‰çš„è©æ¢å’ŒBVZï¼ˆç²¾ç¢ºåŒ¹é…æ¨¡å¼ï¼‰';
                } else {
                    searchHints.definition.textContent = 'è¼¸å…¥é‡‹ç¾©é—œéµè©åæŸ¥å°æ‡‰çš„è©æ¢å’ŒBVZï¼ˆæ”¯æŒå¤šå€‹é—œéµè©æŸ¥è©¢, ç”¨é€—è™Ÿåˆ†éš”ï¼‰';
                }
            }
        }
        
        // æ‰§è¡Œæœç´¢
        async function performSearch(query) {
            if (audioPreloadController) {
                audioPreloadController.abort();
                audioPreloadController = null;
            }
            
            const results = searchData(query);
            currentResults = results;
            
            displayResults(results, query);
            
            startSmartPreload(results);
        }
        
        // æœç´¢æ•°æ®
        function searchData(query) {
            if (currentMainMode === 'character') {
                return searchDictionary(query);
            } else if (currentMainMode === 'vocab') {
                return searchVocabulary(query);
            } else if (currentMainMode === 'definition') {
                return searchDefinition(query);
            }
            return [];
        }
        
        // æœç´¢å­—å…¸æ•°æ®
        function searchDictionary(query) {
            if (!dictionaryData.length) return [];
            
            const searchTerms = query.split(CONFIG.SEPARATOR).filter(term => term.length > 0);
            const results = [];
            
            if (currentSubMode === 'character') {
                if (exactMatch) {
                    const termSet = new Set(searchTerms);
                    for (let i = 0; i < dictionaryData.length; i++) {
                        const item = dictionaryData[i];
                        if (item.å–®å­— && termSet.has(item.å–®å­—)) {
                            results.push(item);
                        }
                    }
                } else {
                    for (let i = 0; i < dictionaryData.length; i++) {
                        const item = dictionaryData[i];
                        if (item.å–®å­—) {
                            for (let j = 0; j < searchTerms.length; j++) {
                                if (item.å–®å­—.includes(searchTerms[j])) {
                                    results.push(item);
                                    break;
                                }
                            }
                        }
                    }
                }
            } else {
                if (exactMatch) {
                    const termSet = new Set(searchTerms);
                    for (let i = 0; i < dictionaryData.length; i++) {
                        const item = dictionaryData[i];
                        if (item.BVZ && termSet.has(item.BVZ)) {
                            results.push(item);
                        }
                    }
                } else {
                    for (let i = 0; i < dictionaryData.length; i++) {
                        const item = dictionaryData[i];
                        if (item.BVZ) {
                            for (let j = 0; j < searchTerms.length; j++) {
                                if (item.BVZ.includes(searchTerms[j])) {
                                    results.push(item);
                                    break;
                                }
                            }
                        }
                    }
                }
            }
            
            return results.slice(0, CONFIG.MAX_RESULTS);
        }
        
        // æœç´¢è¯æ±‡æ•°æ®
        function searchVocabulary(query) {
            if (!vocabularyData.length) return [];
            
            const searchTerms = query.split(CONFIG.SEPARATOR).filter(term => term.length > 0);
            const selectedCategory = categorySelects.vocab.value;
            const results = [];
            
            // ç­›é€‰åˆ†ç±»
            let filteredData = vocabularyData;
            if (selectedCategory !== 'all') {
                filteredData = vocabularyData.filter(item => item.é¡åˆ¥ === selectedCategory);
            }
            
            if (currentSubMode === 'vocab-bvz') {
                if (exactMatch) {
                    const termSet = new Set(searchTerms);
                    for (let i = 0; i < filteredData.length; i++) {
                        const item = filteredData[i];
                        if (item.BVZ && termSet.has(item.BVZ)) {
                            results.push(item);
                        }
                    }
                } else {
                    // æ¨¡ç³Šæœç´¢ï¼šå¿½ç•¥è¿å­—ç¬¦
                    for (let i = 0; i < filteredData.length; i++) {
                        const item = filteredData[i];
                        if (item.BVZ) {
                            const cleanBVZ = item.BVZ.replace(/[-ï¼]/g, '');
                            for (let j = 0; j < searchTerms.length; j++) {
                                const cleanTerm = searchTerms[j].replace(/[-ï¼]/g, '');
                                if (cleanBVZ.includes(cleanTerm)) {
                                    results.push(item);
                                    break;
                                }
                            }
                        }
                    }
                }
            } else {
                if (exactMatch) {
                    const termSet = new Set(searchTerms);
                    for (let i = 0; i < filteredData.length; i++) {
                        const item = filteredData[i];
                        if (item.è©æ¢ && termSet.has(item.è©æ¢)) {
                            results.push(item);
                        }
                    }
                } else {
                    for (let i = 0; i < filteredData.length; i++) {
                        const item = filteredData[i];
                        if (item.è©æ¢) {
                            for (let j = 0; j < searchTerms.length; j++) {
                                if (item.è©æ¢.includes(searchTerms[j])) {
                                    results.push(item);
                                    break;
                                }
                            }
                        }
                    }
                }
            }
            
            return results.slice(0, CONFIG.MAX_RESULTS);
        }
        
        // æœç´¢é‡Šä¹‰
        function searchDefinition(query) {
            if (!vocabularyData.length) return [];
            
            const searchTerms = query.split(CONFIG.SEPARATOR).filter(term => term.length > 0);
            const selectedCategory = categorySelects.definition.value;
            const results = [];
            
            // ç­›é€‰åˆ†ç±»
            let filteredData = vocabularyData;
            if (selectedCategory !== 'all') {
                filteredData = vocabularyData.filter(item => item.é¡åˆ¥ === selectedCategory);
            }
            
            if (exactMatch) {
                // ç²¾ç¡®åŒ¹é…ï¼šæ•´ä¸ªé‡Šä¹‰å®Œå…¨åŒ¹é…
                for (let i = 0; i < filteredData.length; i++) {
                    const item = filteredData[i];
                    if (item.é‡‹ç¾©) {
                        for (let j = 0; j < searchTerms.length; j++) {
                            if (item.é‡‹ç¾© === searchTerms[j]) {
                                results.push(item);
                                break;
                            }
                        }
                    }
                }
            } else {
                // æ¨¡ç³ŠåŒ¹é…ï¼šåŒ…å«å…³é”®è¯
                for (let i = 0; i < filteredData.length; i++) {
                    const item = filteredData[i];
                    if (item.é‡‹ç¾©) {
                        for (let j = 0; j < searchTerms.length; j++) {
                            if (item.é‡‹ç¾©.includes(searchTerms[j])) {
                                results.push(item);
                                break;
                            }
                        }
                    }
                }
            }
            
            return results.slice(0, CONFIG.MAX_RESULTS);
        }
        
        // æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥
        function startSmartPreload(results) {
            if (!results.length) return;
            
            audioPreloadController = new AbortController();
            const signal = audioPreloadController.signal;
            
            const immediateUrls = getAudioUrls(results, 0, CONFIG.PRELOAD_IMMEDIATE);
            preloadAudioBatch(immediateUrls, 'high', signal).then(() => {
                enableAudioButtons(0, CONFIG.PRELOAD_IMMEDIATE);
                
                const priorityUrls = getAudioUrls(results, CONFIG.PRELOAD_IMMEDIATE, CONFIG.PRELOAD_PRIORITY);
                return preloadAudioBatch(priorityUrls, 'medium', signal);
            }).then(() => {
                enableAudioButtons(CONFIG.PRELOAD_IMMEDIATE, CONFIG.PRELOAD_PRIORITY);
                
                const backgroundUrls = getAudioUrls(results, CONFIG.PRELOAD_PRIORITY, CONFIG.PRELOAD_PRIORITY + CONFIG.PRELOAD_BACKGROUND);
                return preloadAudioBatch(backgroundUrls, 'low', signal);
            }).then(() => {
                enableAudioButtons(CONFIG.PRELOAD_PRIORITY, results.length);
            }).catch(err => {
                if (err.name !== 'AbortError') {
                    console.warn('é¢„åŠ è½½éƒ¨åˆ†å¤±è´¥:', err);
                }
            });
        }
        
        // è·å–éŸ³é¢‘URLåˆ—è¡¨
        function getAudioUrls(results, start, end) {
            const urls = [];
            const limit = Math.min(end, results.length);
            
            for (let i = start; i < limit; i++) {
                const item = results[i];
                
                // ä¸»éŸ³é¢‘
                if (item.audioUrl && !CONFIG.AUDIO_CACHE.has(item.audioUrl)) {
                    urls.push(item.audioUrl);
                }
                
                // ä¾‹å¥éŸ³é¢‘ï¼ˆå¦‚æœæ˜¯è¯æ±‡æ•°æ®ï¼‰
                if (item.type === 'vocabulary' && item.ä¾‹å¥éŸ³é » && !CONFIG.AUDIO_CACHE.has(item.ä¾‹å¥éŸ³é »)) {
                    urls.push(item.ä¾‹å¥éŸ³é »);
                }
            }
            return urls;
        }
        
        // æ‰¹é‡é¢„åŠ è½½éŸ³é¢‘
        async function preloadAudioBatch(urls, priority = 'medium', signal) {
            if (!urls.length) return;
            
            console.log(`å¼€å§‹${priority}ä¼˜å…ˆçº§é¢„åŠ è½½ ${urls.length} ä¸ªéŸ³é¢‘`);
            
            let concurrency = 1;
            if (priority === 'high') concurrency = 3;
            else if (priority === 'medium') concurrency = 2;
            else concurrency = 1;
            
            for (let i = 0; i < urls.length; i += concurrency) {
                if (signal.aborted) break;
                
                const batch = urls.slice(i, i + concurrency);
                const promises = batch.map(url => preloadSingleAudio(url, signal));
                
                await Promise.all(promises);
                
                if (i + concurrency < urls.length && !signal.aborted) {
                    await new Promise(resolve => setTimeout(resolve, priority === 'high' ? 0 : 50));
                }
            }
        }
        
        // é¢„åŠ è½½å•ä¸ªéŸ³é¢‘
        async function preloadSingleAudio(audioUrl, signal) {
            if (CONFIG.AUDIO_CACHE.has(audioUrl)) {
                return CONFIG.AUDIO_CACHE.get(audioUrl);
            }
            
            try {
                const response = await fetch(audioUrl, { signal });
                if (!response.ok) return null;
                
                const blob = await response.blob();
                
                let audioBlob = blob;
                if (!blob.type.startsWith('audio/')) {
                    audioBlob = new Blob([blob], { type: 'audio/mpeg' });
                }
                
                const blobUrl = URL.createObjectURL(audioBlob);
                CONFIG.AUDIO_CACHE.set(audioUrl, blobUrl);
                return blobUrl;
                
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.warn('éŸ³é¢‘é¢„åŠ è½½å¤±è´¥:', audioUrl, error);
                }
                return null;
            }
        }
        
        // å¯ç”¨éŸ³é¢‘æŒ‰é’®
        function enableAudioButtons(start, end) {
            const buttons = resultsContainer.querySelectorAll('.audio-play-btn');
            const limit = Math.min(end * 2, buttons.length);
            
            for (let i = start; i < limit; i++) {
                const button = buttons[i];
                if (button.disabled) {
                    const audioUrl = decodeURIComponent(button.getAttribute('data-audio-url'));
                    if (CONFIG.AUDIO_CACHE.has(audioUrl)) {
                        button.disabled = false;
                        button.title = 'é»æ“Šæ’­æ”¾ç™¼éŸ³';
                    }
                }
            }
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ - ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æ­£ç¡®æ˜¾ç¤º
        function displayResults(results, query) {
            if (!results.length) {
                showMessage(`æ²’æœ‰æ‰¾åˆ°èˆ‡"${query}"ç›¸é—œçš„çµæœ`);
                return;
            }
            
            let html = `
                <div class="results-header">
                    <h2>æœç´¢çµæœ</h2>
                    <div class="results-count">æ‰¾åˆ° ${results.length} æ¢çµæœ ${exactMatch ? '(ç²¾ç¢ºåŒ¹é…)' : ''}</div>
                </div>
            `;
            
            results.forEach((item, index) => {
                console.log('æ˜¾ç¤ºæœç´¢ç»“æœé¡¹:', item);
                
                const hasAudio = item.audioUrl && item.audioUrl.length > 0;
                const audioId = `audio-${Date.now()}-${index}`;
                const isPreloaded = hasAudio && CONFIG.AUDIO_CACHE.has(item.audioUrl);
                const isTopResult = index < CONFIG.PRELOAD_IMMEDIATE;
                
                if (item.type === 'dictionary') {
                    html += `
                        <div class="result-item" data-index="${index}">
                            <div class="character">${item.å–®å­—}</div>
                            <div class="details">
                                <div class="detail-item">
                                    <span class="label">BVZ:</span> 
                                    <span class="bvz-value">${item.BVZ}</span>
                                    ${hasAudio ? `
                                    <div class="audio-container">
                                        <button class="audio-play-btn" 
                                                data-audio-id="${audioId}" 
                                                data-audio-url="${encodeURIComponent(item.audioUrl)}"
                                                title="é»æ“Šæ’­æ”¾ç™¼éŸ³"
                                                ${isPreloaded || isTopResult ? '' : 'disabled'}>
                                        </button>
                                    </div>
                                    ` : ''}
                                </div>
                                ${item.Note ? `
                                <div class="detail-item">
                                    <span class="label">æ³¨é‡‹:</span> 
                                    <span>${item.Note}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else if (item.type === 'vocabulary') {
                    const hasExampleAudio = item.ä¾‹å¥éŸ³é » && item.ä¾‹å¥éŸ³é ».length > 0;
                    const exampleAudioId = `example-audio-${Date.now()}-${index}`;
                    const isExamplePreloaded = hasExampleAudio && CONFIG.AUDIO_CACHE.has(item.ä¾‹å¥éŸ³é »);
                    const hasExample = item.ä¾‹å¥ || item.ä¾‹å¥BVZ || item.ä¾‹å¥ç¿»è­¯;
                    
                    html += `
                        <div class="result-item" data-index="${index}">
                            <div class="character">${item.è©æ¢ || 'ç„¡è©æ¢'}</div>
                            <div class="details">
                                <div class="detail-item">
                                    <span class="label">BVZ:</span> 
                                    <span class="bvz-value">${item.BVZ || 'ç„¡BVZ'}</span>
                                    ${item.é¡åˆ¥ ? `<span class="category-tag">${item.é¡åˆ¥}</span>` : ''}
                                    ${hasAudio ? `
                                    <div class="audio-container">
                                        <button class="audio-play-btn" 
                                                data-audio-id="${audioId}" 
                                                data-audio-url="${encodeURIComponent(item.audioUrl)}"
                                                title="é»æ“Šæ’­æ”¾ç™¼éŸ³"
                                                ${isPreloaded || isTopResult ? '' : 'disabled'}>
                                        </button>
                                    </div>
                                    ` : ''}
                                </div>
                                ${item.é‡‹ç¾© ? `
                                <div class="detail-item">
                                    <span class="label">é‡‹ç¾©:</span> 
                                    <span>${item.é‡‹ç¾©}</span>
                                </div>
                                ` : ''}
                            </div>
                            ${hasExample ? `
                            <div class="example-container">
                                <div class="example-header">
                                    <span>ä¾‹å¥</span>
                                    ${hasExampleAudio ? `
                                    <div class="audio-container">
                                        <button class="audio-play-btn example-audio-btn" 
                                                data-audio-id="${exampleAudioId}" 
                                                data-audio-url="${encodeURIComponent(item.ä¾‹å¥éŸ³é »)}"
                                                title="é»æ“Šæ’­æ”¾ä¾‹å¥ç™¼éŸ³"
                                                ${isExamplePreloaded || isTopResult ? '' : 'disabled'}>
                                        </button>
                                    </div>
                                    ` : ''}
                                </div>
                                ${item.ä¾‹å¥ ? `
                                <div class="example-text">${item.ä¾‹å¥}</div>
                                ` : ''}
                                ${item.ä¾‹å¥BVZ ? `
                                <div class="example-bvz">${item.ä¾‹å¥BVZ}</div>
                                ` : ''}
                                ${item.ä¾‹å¥ç¿»è­¯ ? `
                                <div class="example-translation">${item.ä¾‹å¥ç¿»è­¯}</div>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                    `;
                }
            });
            
            resultsContainer.innerHTML = html;
            
            // æ·»åŠ éŸ³é¢‘æŒ‰é’®äº‹ä»¶
            const audioButtons = resultsContainer.querySelectorAll('.audio-play-btn');
            audioButtons.forEach(button => {
                button.addEventListener('click', handleAudioPlay);
            });
        }
        
        // å¤„ç†éŸ³é¢‘æ’­æ”¾
        async function handleAudioPlay(event) {
            const button = event.currentTarget;
            const audioUrl = decodeURIComponent(button.getAttribute('data-audio-url'));
            
            if (!audioUrl) return;
            
            // å¦‚æœå·²ç»åœ¨æ’­æ”¾ï¼Œåœæ­¢å®ƒ
            if (currentAudio && currentPlayingButton === button) {
                stopCurrentAudio();
                return;
            }
            
            // åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘
            if (currentAudio) {
                stopCurrentAudio();
            }
            
            // æ£€æŸ¥ç¼“å­˜
            let audioBlobUrl = CONFIG.AUDIO_CACHE.get(audioUrl);
            
            if (!audioBlobUrl) {
                // å¦‚æœä¸åœ¨ç¼“å­˜ï¼Œç«‹å³ä¸‹è½½
                console.log('éŸ³é¢‘ä¸åœ¨ç¼“å­˜ï¼Œç«‹å³ä¸‹è½½:', audioUrl);
                try {
                    const response = await fetch(audioUrl);
                    const blob = await response.blob();
                    audioBlobUrl = URL.createObjectURL(new Blob([blob], { type: 'audio/mpeg' }));
                    CONFIG.AUDIO_CACHE.set(audioUrl, audioBlobUrl);
                } catch (error) {
                    console.error('éŸ³é¢‘ä¸‹è½½å¤±è´¥:', error);
                    return;
                }
            }
            
            // æ’­æ”¾éŸ³é¢‘
            playAudio(audioBlobUrl, button);
        }
        
        // æ’­æ”¾éŸ³é¢‘
        function playAudio(audioUrl, button) {
            currentAudio = new Audio(audioUrl);
            currentPlayingButton = button;
            
            // åº”ç”¨å½“å‰éŸ³é‡è®¾ç½®
            currentAudio.volume = currentVolume;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            button.classList.add('playing');
            button.title = 'é»æ“Šæš«åœ';
            
            // éŸ³é¢‘äº‹ä»¶å¤„ç†
            currentAudio.addEventListener('error', (e) => {
                console.error('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', currentAudio.error);
                resetAudioButton(button);
                currentAudio = null;
                currentPlayingButton = null;
            });
            
            currentAudio.addEventListener('ended', () => {
                resetAudioButton(button);
                currentAudio = null;
                currentPlayingButton = null;
            });
            
            // å¼€å§‹æ’­æ”¾
            currentAudio.play().catch(error => {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                resetAudioButton(button);
                currentAudio = null;
                currentPlayingButton = null;
            });
        }
        
        // åœæ­¢å½“å‰éŸ³é¢‘
        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                
                if (currentPlayingButton) {
                    resetAudioButton(currentPlayingButton);
                }
                
                currentAudio = null;
                currentPlayingButton = null;
            }
        }
        
        // é‡ç½®éŸ³é¢‘æŒ‰é’®çŠ¶æ€
        function resetAudioButton(button) {
            button.classList.remove('playing');
            button.title = 'æ’­æ”¾ç™¼éŸ³';
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            resultsContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è¼‰å­—å…¸æ•¸æ“š...</p>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <div class="no-results-icon">ğŸ”</div>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            resultsContainer.innerHTML = `
                <div class="error-message">
                    <strong>éŒ¯èª¤:</strong> ${message}
                </div>
            `;
        }
        
        // æ¸…ç†Blob URL
        window.addEventListener('beforeunload', () => {
            CONFIG.AUDIO_CACHE.forEach(blobUrl => {
                URL.revokeObjectURL(blobUrl);
            });
            CONFIG.AUDIO_CACHE.clear();
            
            if (audioPreloadController) {
                audioPreloadController.abort();
            }
        });
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
